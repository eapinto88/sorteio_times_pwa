<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sortear Times</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      background: url('campo-fundo.png') no-repeat center center fixed;
      background-size: cover;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background-color: #fff;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    h1 {
      text-align: center;
    }

    label {
      font-weight: bold;
      margin-top: 1rem;
      display: block;
    }

    input[type="file"],
    input[type="text"],
    select {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }

    .times-container {
      margin-top: 1rem;
    }

    .time {
      background-color: #e9f0fb;
      padding: 0.8rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    button {
      width: 100%;
      background-color: #0014cc;
      color: white;
      padding: 0.8rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #002fe6;
    }

    .whatsapp-button {
      background-color: #ba0000;
      margin-top: 1rem;
    }

    .radio-group {
      display: flex;
      gap: 10px;
      margin: 0.5rem 0;
    }

    .team-names {
      display: flex;
      gap: 10px;
    }

    .team-names select,
    .team-names input {
      flex: 1;
    }
  </style>
</head>
<body>

  <div style="text-align: center; margin-bottom: 1rem;">
  <img src="logo.png" alt="Logo" style="max-width: 150px; height: auto;" />
  </div>
  <div class="container">
    <h1>Sortear Times</h1>

    <label for="csvInput">Importar CSV (.csv com ,)</label>
    <input type="file" id="csvInput" accept=".csv">

    <label>Quantidade de times:</label>
    <div class="radio-group">
      <label><input type="radio" name="numTimes" value="2" checked> 2</label>
      <label><input type="radio" name="numTimes" value="3"> 3</label>
      <label><input type="radio" name="numTimes" value="4"> 4</label>
    </div>

    <label>Nome dos Times (opcional):</label>
    <div class="team-names">
      <input type="text" placeholder="Time 1" id="timeNome1">
      <input type="text" placeholder="Time 2" id="timeNome2">
    </div>

    <button onclick="processarCSV()">Sortear Times</button>

    <button class="whatsapp-button" onclick="compartilharNoWhatsApp()">Compartilhar no WhatsApp</button>

    <div id="timesResultado" class="times-container"></div>
  </div>

  <script>
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function distribuirEquilibrado(grupo, times) {
      let i = 0;
      grupo.forEach(jogador => {
        times[i % times.length].push(jogador);
        i++;
      });
    }

    function sortearTimesEquilibrados(jogadores, numTimes) {
      const goleiros = shuffle(jogadores.filter(j => j.posicao.toLowerCase() === 'goleiro'));
      const zagueiros = shuffle(jogadores.filter(j => j.posicao.toLowerCase() === 'zagueiro'));
      const meios = shuffle(jogadores.filter(j => j.posicao.toLowerCase() === 'meio'));
      const atacantes = shuffle(jogadores.filter(j => j.posicao.toLowerCase() === 'ataque'));
      const outros = shuffle(jogadores.filter(j =>
        !['goleiro', 'zagueiro', 'meio', 'ataque'].includes(j.posicao.toLowerCase())
      ));

      const times = Array.from({ length: numTimes }, () => []);
      distribuirEquilibrado(goleiros, times);
      distribuirEquilibrado(zagueiros, times);
      distribuirEquilibrado(meios, times);
      distribuirEquilibrado(atacantes, times);
      distribuirEquilibrado(outros, times);
      return times;
    }

    function processarCSV() {
      const fileInput = document.getElementById('csvInput');
      const file = fileInput.files[0];
      if (!file) {
        alert("Por favor, selecione um arquivo CSV.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (event) {
        const lines = event.target.result.trim().split('\n');
        const jogadores = lines.slice(1).map(line => {
          const [nome, posicao, ano] = line.split(',');
          return {
            nome: nome.trim(),
            posicao: posicao?.trim(),
            ano: ano?.trim()
          };
        });

        const numTimes = parseInt(document.querySelector('input[name="numTimes"]:checked').value);
        const times = sortearTimesEquilibrados(jogadores, numTimes);
        exibirTimes(times);
      };

      reader.readAsText(file);
    }

    function exibirTimes(times) {
      const resultadoDiv = document.getElementById('timesResultado');
      resultadoDiv.innerHTML = '';

      const nomesPersonalizados = [
        document.getElementById('timeNome1').value || 'Time 1',
        document.getElementById('timeNome2').value || 'Time 2',
        'Time 3',
        'Time 4'
      ];

      times.forEach((time, index) => {
        const div = document.createElement('div');
        div.classList.add('time');

        const nomeTime = nomesPersonalizados[index] || `Time ${index + 1}`;
        const jogadoresList = time.map(j => `${j.nome} (${j.posicao})${j.idade ? ` - ${j.idade} anos` : ''}`).join('<br>');
        div.innerHTML = `<strong>${nomeTime}</strong><br>${jogadoresList}`;
        resultadoDiv.appendChild(div);
      });
    }

    function compartilharNoWhatsApp() {
      const text = document.getElementById('timesResultado').innerText;
      const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>
